#!/usr/bin/env ruby

$:.unshift File.expand_path('../../lib', File.realpath(__FILE__))

require 'coresys'

case ARGV.shift
when 'edit'
  formula = Coresys::Formula.find(ARGV[0])
  error!("EDITOR environment variable is not set") unless ENV['EDITOR']
  file = (Coresys.formula + formula.file_name).to_s + '.rb'
  exec ENV['SHELL'], '-c', ENV['EDITOR'] + ' "$@"', '--', file
when 'install'
  Coresys.install(ARGV[0])
when 'uninstall', 'remove'
  Coresys.uninstall(ARGV[0])
when 'link'
  Coresys.link(ARGV[0])
when 'unlink'
  Coresys.unlink(ARGV[0])
when 'upgrade'
  Coresys.upgrade(ARGV[0])
when 'cleanup'
  Coresys.cellar.children.each do |entry|
    next unless entry.directory?
    Coresys.cleanup(entry.basename)
  end

  # Only cleanup cache when this is a general cleanup
  Coresys.cache.children.each do |entry|
    entry.unlink if entry.file?
  end if ARGV.empty?
end
